blueprint:
  name: Fire State Management
  description: Automates fire state transitions based on temperature thresholds.
  domain: automation
  input:
    temperature_sensor:
      name: Temperature Sensor
      description: The sensor that provides temperature readings.
      selector:
        entity:
          domain: sensor
          device_class: temperature
    fire_state:
      name: Fire State
      description: The input select entity that stores the fire state.
      selector:
        entity:
          domain: input_select
    fire_starting_threshold:
      name: Fire Starting Threshold
      description: Temperature threshold to transition to Fire Starting.
      default: 100
      selector:
        number:
          min: 50
          max: 200
          unit_of_measurement: 째F
    warming_threshold:
      name: Warming Threshold
      description: Temperature threshold to transition to Warming Up.
      default: 120
      selector:
        number:
          min: 100
          max: 250
          unit_of_measurement: 째F
    burning_threshold:
      name: Burning Threshold
      description: Temperature threshold to transition to Burning.
      default: 250
      selector:
        number:
          min: 200
          max: 400
          unit_of_measurement: 째F
    cooling_threshold:
      name: Cooling Threshold
      description: Temperature threshold to transition to Cooling Down.
      default: 200
      selector:
        number:
          min: 100
          max: 250
          unit_of_measurement: 째F

mode: restart

trigger:
  - platform: state
    entity_id: !input temperature_sensor

action:
  - variables:
      current_state: "{{ states(input.fire_state) }}"
      temperature: "{{ states(input.temperature_sensor) | float }}"
      fire_starting_threshold: !input fire_starting_threshold
      warming_threshold: !input warming_threshold
      burning_threshold: !input burning_threshold
      cooling_threshold: !input cooling_threshold

  - choose:
      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Off' and temperature > fire_starting_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Fire Starting"

      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Fire Starting' and temperature > warming_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Warming Up"

      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Warming Up' and temperature > burning_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Burning"

      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Burning' and temperature < cooling_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Cooling Down"

      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Cooling Down' and temperature < fire_starting_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Off"

      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Cooling Down' and temperature > warming_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Warming Up"

      - conditions:
          - condition: template
            value_template: "{{ current_state == 'Warming Up' and temperature > burning_threshold }}"
        sequence:
          - service: input_select.select_option
            data:
              entity_id: !input fire_state
              option: "Burning"
