blueprint:
  name: Cycle Scenes with Input Button
  description: Cycle through an unlimited number of scenes when an input_button helper is pressed.
  domain: automation
  input:
    button:
      name: Input Button Helper Entity
      description: The input_button helper that will trigger the scene cycling.
      selector:
        entity:
          domain: input_button
    scenes:
      name: Scenes
      description: List of scenes to cycle through. Supports infinite scenes.
      selector:
        entity:
          domain: scene
          multiple: true
    scene_index:
      name: Scene Index Helper
      description: Input number to keep track of the current scene.
      selector:
        entity:
          domain: input_number

trigger:
  - platform: event
    event_type: call_service
    event_data:
      domain: input_button
      service: press
      service_data:
        entity_id: !input button

action:
  - variables:
      scene_index_id: !input scene_index
      current_index: "{{ states(scene_index_id) | int(default=0) }}"
      scenes_list: !input scenes
      total_scenes: "{{ scenes_list | length }}"
      next_index: "{{ (current_index + 1) % total_scenes }}"

  - service: input_number.set_value
    target:
      entity_id: "{{ scene_index_id }}"
    data:
      value: "{{ next_index }}"

  - wait_template: "{{ states(scene_index_id) | int == next_index }}"
    timeout: "00:00:02"
    continue_on_timeout: true
  
  - service: scene.turn_on
    target:
      entity_id: "{{ scenes_list[next_index] }}"

mode: restart
