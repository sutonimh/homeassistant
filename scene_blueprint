blueprint:
  name: Cycle Scenes with Button
  description: Cycle through multiple scenes when a button is pressed.
  domain: automation
  input:
    button:
      name: Button Entity
      description: The button that will trigger the scene cycling.
      selector:
        entity:
          domain: binary_sensor
          device_class: button
    scenes:
      name: Scenes
      description: List of scenes to cycle through. Supports any number of scenes.
      selector:
        entity:
          domain: scene
          multiple: true

action:
  - service: input_number.set_value
    target:
      entity_id: input_number.scene_index
    data:
      value: 0
    condition: "{{ states('input_number.scene_index') == 'unknown' }}"

  - variables:
      current_index: "{{ states('input_number.scene_index') | int }}"
      scenes_list: "{{ input.scenes | list }}"
      total_scenes: "{{ scenes_list | length }}"
      next_index: "{{ (current_index + 1) % total_scenes }}"
  
  - service: scene.turn_on
    target:
      entity_id: "{{ scenes_list[next_index] }}"

  - service: input_number.set_value
    target:
      entity_id: input_number.scene_index
    data:
      value: "{{ next_index }}"

mode: restart
