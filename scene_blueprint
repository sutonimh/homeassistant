blueprint:
  name: Cycle Through Scenes with Button
  description: Cycles through up to 5 scenes when a button helper is pressed.
  domain: automation
  input:
    button_helper:
      name: Button Helper
      description: The button helper to trigger scene cycling.
      selector:
        entity:
          domain: input_button
    scene_1:
      name: Scene 1
      selector:
        entity:
          domain: scene
    scene_2:
      name: Scene 2
      selector:
        entity:
          domain: scene
    scene_3:
      name: Scene 3 (Optional)
      default: ""
      selector:
        entity:
          domain: scene
    scene_4:
      name: Scene 4 (Optional)
      default: ""
      selector:
        entity:
          domain: scene
    scene_5:
      name: Scene 5 (Optional)
      default: ""
      selector:
        entity:
          domain: scene
    scene_index_helper:
      name: Scene Index Helper
      description: An input_number helper to track the current scene index.
      selector:
        entity:
          domain: input_number

trigger:
  - platform: state
    entity_id: !input button_helper

variables:
  scenes:
    - !input scene_1
    - !input scene_2
    - !input scene_3
    - !input scene_4
    - !input scene_5
  scenes_filtered: "{{ scenes | select('string') | list }}"
  scene_count: "{{ scenes_filtered | count }}"

action:
  - variables:
      current_scene_index: >-
        {% set current = states(!input scene_index_helper) | int %}
        {{ (current + 1) % scene_count }}
  - service: input_number.set_value
    target:
      entity_id: !input scene_index_helper
    data:
      value: "{{ current_scene_index }}"
  - service: scene.turn_on
    target:
      entity_id: "{{ scenes_filtered[current_scene_index] }}"

mode: restart
